<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>객체의 책임(도메인 주도) | EK Dev Blog</title>
<meta name=keywords content><meta name=description content="목적 UserPointService 의 충전/사용 메서드를 리팩터링한다 절차지향적인 코드를 객체지향적으로 변경해보자 냄새나는 코드? 포인트 충전 로직 개선시키기 수정 이전 (절차지향적) 포인트 충전 내부로직 플로우 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // PointServiceImpl.java @Service @RequiredArgsConstructor public class PointServiceImpl implements PointService { @Override public ChargeResponse charge(ChargeRequest request) { long id = request.id(); long amount = request.amount(); UserPoint userPoint = this."><meta name=author content><link rel=canonical href=https://loveAlakazam.github.io/blog/docs/object-responsibility/><link crossorigin=anonymous href=/blog/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://loveAlakazam.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://loveAlakazam.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://loveAlakazam.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://loveAlakazam.github.io/blog/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://loveAlakazam.github.io/blog/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://loveAlakazam.github.io/blog/docs/object-responsibility/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://loveAlakazam.github.io/blog/docs/object-responsibility/"><meta property="og:site_name" content="EK Dev Blog"><meta property="og:title" content="객체의 책임(도메인 주도)"><meta property="og:description" content="목적 UserPointService 의 충전/사용 메서드를 리팩터링한다 절차지향적인 코드를 객체지향적으로 변경해보자 냄새나는 코드? 포인트 충전 로직 개선시키기 수정 이전 (절차지향적) 포인트 충전 내부로직 플로우 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // PointServiceImpl.java @Service @RequiredArgsConstructor public class PointServiceImpl implements PointService { @Override public ChargeResponse charge(ChargeRequest request) { long id = request.id(); long amount = request.amount(); UserPoint userPoint = this."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:published_time" content="2025-03-26T00:00:00+00:00"><meta property="article:modified_time" content="2025-03-26T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="객체의 책임(도메인 주도)"><meta name=twitter:description content="목적 UserPointService 의 충전/사용 메서드를 리팩터링한다 절차지향적인 코드를 객체지향적으로 변경해보자 냄새나는 코드? 포인트 충전 로직 개선시키기 수정 이전 (절차지향적) 포인트 충전 내부로직 플로우 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // PointServiceImpl.java @Service @RequiredArgsConstructor public class PointServiceImpl implements PointService { @Override public ChargeResponse charge(ChargeRequest request) { long id = request.id(); long amount = request.amount(); UserPoint userPoint = this."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Docs","item":"https://loveAlakazam.github.io/blog/docs/"},{"@type":"ListItem","position":2,"name":"객체의 책임(도메인 주도)","item":"https://loveAlakazam.github.io/blog/docs/object-responsibility/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"객체의 책임(도메인 주도)","name":"객체의 책임(도메인 주도)","description":"목적 UserPointService 의 충전/사용 메서드를 리팩터링한다 절차지향적인 코드를 객체지향적으로 변경해보자 냄새나는 코드? 포인트 충전 로직 개선시키기 수정 이전 (절차지향적) 포인트 충전 내부로직 플로우 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // PointServiceImpl.java @Service @RequiredArgsConstructor public class PointServiceImpl implements PointService { @Override public ChargeResponse charge(ChargeRequest request) { long id = request.id(); long amount = request.amount(); UserPoint userPoint = this.","keywords":[],"articleBody":"목적 UserPointService 의 충전/사용 메서드를 리팩터링한다 절차지향적인 코드를 객체지향적으로 변경해보자 냄새나는 코드? 포인트 충전 로직 개선시키기 수정 이전 (절차지향적) 포인트 충전 내부로직 플로우 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 // PointServiceImpl.java @Service @RequiredArgsConstructor public class PointServiceImpl implements PointService { @Override public ChargeResponse charge(ChargeRequest request) { long id = request.id(); long amount = request.amount(); UserPoint userPoint = this.userPointRepository.findById(id); long myPoint = userPoint.point(); // 포인트내역에 '충전' 기록 this.pointHistoryRepository.insert(id, amount, TransactionType.CHARGE); // 포인트 충전 -\u003e 포인트 업데이트 UserPoint result = this.userPointRepository.save(id, myPoint + amount); return ChargeResponse.from(result); } } 수정 이후 (객체지향적) 포인트 에게 ‘충전’ 역할을 부여하기 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 public record UserPoint( long id, long point, long updateMillis ) { public static UserPoint empty(long id) { return new UserPoint(id, 0, System.currentTimeMillis()); } /** * UserPoint 정책 * * - MIN_CHARGE_POINT_AMOUNT: 최소 포인트 충전금액 * - MAX_CHARGE_POINT_AMOUNT: 최대 포인트 충전금액 * * - MIN_USE_POINT_AMOUNT: 최소 포인트 사용금액 * - MAX_USE_POINT_AMOUNT: 최대 포인트 사용금액 */ public static int MIN_CHARGE_POINT_AMOUNT = 1000; public static int MAX_CHARGE_POINT_AMOUNT = 50000; public static int MIN_USE_POINT_AMOUNT = 100; public static int MAX_USE_POINT_AMOUNT = 50000; // 포인트 충전에 대한 정책 public UserPoint charge(long amount) { long point = this.point + amount; // 포인트 충전 return new UserPoint(id, point, updateMillis); // 충전된 값으로 신규 인스턴스를 리턴 } } UserPoint가 클래스라면 set으로 데이터를 변경하여 수정할 수 있습니다. 하지만 record 클래스는 데이터를 읽을 수 있지만, 데이터변경을 금지하기 때문에 set 이 허용하지 않기때문에 포인트충전된 값으로 포인트 객체를 생성하여 리턴하였습니다.\n포인트 충전 로직 개선하기 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // PointServiceImpl.java @Service @RequiredArgsConstructor public class PointServiceImpl implements PointService { @Override public ChargeResponse charge(ChargeRequest request) { long id = request.id(); long amount = request.amount(); // 보유 포인트 조회 UserPoint myPoint = this.userPointRepository.findById(id); // 포인트 계산 및 충전 (객체의 책임 부여) myPoint.charge(amount); // 포인트내역에 '충전' 기록 this.pointHistoryRepository.insert(id, amount, TransactionType.CHARGE); // 보유포인트 정보 수정 UserPoint result = this.userPointRepository.save(id, myPoint.point()); // 응답DTO로 감싸서 리턴 return ChargeResponse.from(result); } } 포인트 사용 로직 개선시키기 수정 이전 (절차지향적) 포인트 사용 내부로직 플로우\n보유 포인트 조회(db) 보유포인트와 사용포인트 비교 포인트 내역 기록(db) 보유포인트- 사용포인트 계산 보유포인트 업데이트(db) (db) 는 의존성인 래포지토리의 메서드를 이용 문제점 분석\nthis.userPointRepository.save(id, myPoint - amount) : ‘사용’ 메서드안에 포인트사용 이 포함되어있습니다.\nUserPoint 와 관련된 역할이 객체인 UserPoint가 책임을 지지않고 PointService의 use()함수가 책임을 지고 있습니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // PointServiceImpl.java @Service @RequiredArgsConstructor public class PointServiceImpl implements PointService { @Override public UseResponse use(UseRequest request) { long id = request.id(); long amount = request.amount(); UserPoint userPoint = this.userPointRepository.findById(id); long myPoint = userPoint.point(); // 잔고가 사용금액보다 부족할 경우 if( amount \u003e myPoint ) { throw new CustomBusinessException(ErrorCode.OVER_USE_AMOUNT_VALUE_THAN_BALANCE_POLICY); } // 포인트내역에 '사용' 기록 this.pointHistoryRepository.insert(id, amount, TransactionType.USE); // 포인트 사용 UserPoint result = this.userPointRepository.save(id, myPoint - amount); return UseResponse.from(result); } } 수정 이후 (객체지향적) 어떻게 개선할건가?\n보유 포인트 조회(db) ((객체의 책임)) 보유포인트와 사용포인트 비교 -\u003e 보유포인트 - 사용포인트 계산 후 신규포인트를 리턴 포인트 내역 기록(db) 보유 포인트 업데이트(db) (db) 는 의존성인 래포지토리의 메서드를 이용 UserPoint 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 public record UserPoint( long id, long point, long updateMillis ) { ...(생략)... // 포인트 사용에 대한 정책 public UserPoint use(long amount) { // 잔고가 사용금액보다 부족할 경우 CustomBusinessException 예외처리 if(amount \u003e this.point) { throw new CustomBusinessException(ErrorCode.OVER_USE_AMOUNT_VALUE_THAN_BALANCE_POLICY); } long point = this.point - amount; // 포인트 사용 return new UserPoint(id, point, updateMillis); } } UserPointServiceImpl 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 // PointServiceImpl.java @Service @RequiredArgsConstructor public class PointServiceImpl implements PointService { @Override public UseResponse use(UseRequest request) { long id = request.id(); long amount = request.amount(); UserPoint myPoint = this.userPointRepository.findById(id); // 포인트 사용 myPoint = myPoint.use(amount); // 포인트내역에 '사용' 기록 this.pointHistoryRepository.insert(id, amount, TransactionType.USE); // 보유 포인트 수정 UserPoint result = this.userPointRepository.save(id, myPoint.point()); // 응답 DTO로 감싸서 리턴 return UseResponse.from(result); } } 테스트코드 수정 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 @Test void 보유포인트_10000원에_5000원_충전하면_잔액은_15000원이된다() { // given long id = 1L; long initialPoint = 10000L; // 초기 보유 잔액 long amount = 5000L; // 충전금액 UserPoint myPoint = new UserPoint(id, initialPoint, 100L); long pointAfterCharged = myPoint.charge(amount); // 객체에게 책임을 부여 when(userPointRepository.findById(id)).thenReturn(myPoint); // 충전전 보유잔액 when(userPointRepository.save(id, pointAfterCharged)) .thenReturn(new UserPoint(id, pointAfterCharged, myPoint.updateMillis())); // 충전후 보유잔액 // when ChargeResponse response = pointService.charge(new ChargeRequest(id, amount)); // 포인트 5000원 충전 수행 // then assertEquals(myPoint.charge(amount), response.point()); // 충전후 예상값과 실제값 비교 verify(pointHistoryRepository, times(1)).insert(id, amount, TransactionType.CHARGE); // 포인트내역 insert 호출검증 verify(userPointRepository, times(1)).save(id, pointAfterCharged ); // save(포인트정보 수정) 호출검증 } 결론 및 내 생각 객체지향적이라는 것은 마치 객체가 살아움직이는 것처럼 능동적으로 자기역할에 대해서 책임을 지는 것을 의미한다고 생각합니다.\n그러므로 객체에 대한 역할을 객체에게 부여시키는 연습을 해봤고, 이를 통해 코드라인이 줄어들었음을 확인할 수 있게되었습니다.\n객체에게 역할을 부여하고 그 역할에 대한 책임을 지게끔하는게 객체지향이면서 도메인주도개발(DDD)이 아닌가 싶습니다.\n코드가 변경되면 테스트코드도 같이 변경되어야합니다. 그래서 코드도 리팩터링할때도 코드의 변화가 있다면 테스트코드도 알맞게 변경해야됩니다.\n코드를 예쁘게 짤려고하다보면 계속 고민을 하게되는거 같습니다. 처음에는 잘 안보이다가도 다른팀원들과 의논을 나누게되면 코드를 변경하게되는데…\n요즘든 생각은 DTO클래스내부에서 직접 유효성검사를 하기보다는 비즈니스 정책과 관련되어있는 (예를들어 UserPoint 클래스의 id값은 양수여야한다, amount값은 최소금액은 XX원 이상이어야한다 등에 대한) 유효성검사 검증은 UserPoint객체에서 책임함수를 따로 만들어야할까? 라는 생각이 듭니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 public record UserPoint( long id, long point, long updateMillis ) { ...(생략)... // 유효성검사에 대한 정책 // 1. id에 대한 정책 public static void validateId(long id) { if(id \u003c= 0) throw new CustomInvalidRequestException(\"id는 양수여야합니다.\"); } // 2. 충전 금액의 파라미터 인자 amount에 대한 정책 public static void validateChargeAmount(long amount) { if(amouont \u003c= 0 ) throw new CustomInvalidRequestException(\"amount는 양수여야합니다.\"); if(amount \u003c= MIN_CHARGE_POINT_AMOUNT) throw new CustomInvalidRequestException(\"amount는 최소 1000원 이상이어야 합니다.\"); if(amount \u003e MAX_CHARGE_POINT_AMOUNT) throw new CustomInvalidRequestException(\"amount 최댓값은 50000원 입니다.\"); } ... } 첫번째로는 비즈니스 정책만큼 가장중요한게 엔티티 객체입니다. 중요한 엔티티에게 관련 비즈니스 정책을 부여해주는 거죠.\n두번째로는 이러한 책임의 부여는 변경할 가능성이 높고, 심지어 정책이 사라질 수 있는 변경에 대비할 수 있습니다.\n정책과 관련된 책임을 엔티티에게 주게되면, 즉 객체지향적으로 코드를 작성하게되면 절차지향적으로 했을 때 코드로 했을 때보다 불필요한 코드를 줄일 수 있다는걸 경험했습니다.\n","wordCount":"1087","inLanguage":"en","datePublished":"2025-03-26T00:00:00Z","dateModified":"2025-03-26T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://loveAlakazam.github.io/blog/docs/object-responsibility/"},"publisher":{"@type":"Organization","name":"EK Dev Blog","logo":{"@type":"ImageObject","url":"https://loveAlakazam.github.io/blog/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://loveAlakazam.github.io/blog/ accesskey=h title="EK Dev Blog (Alt + H)"><img src=https://loveAlakazam.github.io/apple-touch-icon.png alt aria-label=logo height=35>EK Dev Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://eunkangchoi.github.io/resume/ title=Resume><span>Resume</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://loveAlakazam.github.io/blog/>Home</a>&nbsp;»&nbsp;<a href=https://loveAlakazam.github.io/blog/docs/>Docs</a></div><h1 class="post-title entry-hint-parent">객체의 책임(도메인 주도)</h1><div class=post-meta><span title='2025-03-26 00:00:00 +0000 UTC'>March 26, 2025</span></div></header><div class=post-content><h2 id=목적>목적<a hidden class=anchor aria-hidden=true href=#목적>#</a></h2><ul><li>UserPointService 의 충전/사용 메서드를 리팩터링한다</li><li>절차지향적인 코드를 객체지향적으로 변경해보자</li><li>냄새나는 코드?</li></ul><h2 id=포인트-충전-로직-개선시키기>포인트 충전 로직 개선시키기<a hidden class=anchor aria-hidden=true href=#포인트-충전-로직-개선시키기>#</a></h2><h3 id=수정-이전-절차지향적>수정 이전 (절차지향적)<a hidden class=anchor aria-hidden=true href=#수정-이전-절차지향적>#</a></h3><ul><li>포인트 충전 내부로직 플로우</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span><span class=lnt id=hl-0-11><a class=lnlinks href=#hl-0-11>11</a>
</span><span class=lnt id=hl-0-12><a class=lnlinks href=#hl-0-12>12</a>
</span><span class=lnt id=hl-0-13><a class=lnlinks href=#hl-0-13>13</a>
</span><span class=lnt id=hl-0-14><a class=lnlinks href=#hl-0-14>14</a>
</span><span class=lnt id=hl-0-15><a class=lnlinks href=#hl-0-15>15</a>
</span><span class=lnt id=hl-0-16><a class=lnlinks href=#hl-0-16>16</a>
</span><span class=lnt id=hl-0-17><a class=lnlinks href=#hl-0-17>17</a>
</span><span class=lnt id=hl-0-18><a class=lnlinks href=#hl-0-18>18</a>
</span><span class=lnt id=hl-0-19><a class=lnlinks href=#hl-0-19>19</a>
</span><span class=lnt id=hl-0-20><a class=lnlinks href=#hl-0-20>20</a>
</span><span class=lnt id=hl-0-21><a class=lnlinks href=#hl-0-21>21</a>
</span><span class=lnt id=hl-0-22><a class=lnlinks href=#hl-0-22>22</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// PointServiceImpl.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PointServiceImpl</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>PointService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ChargeResponse</span><span class=w> </span><span class=nf>charge</span><span class=p>(</span><span class=n>ChargeRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>id</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>amount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserPoint</span><span class=w> </span><span class=n>userPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userPointRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>myPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userPoint</span><span class=p>.</span><span class=na>point</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 포인트내역에 &#39;충전&#39; 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>pointHistoryRepository</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>TransactionType</span><span class=p>.</span><span class=na>CHARGE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 포인트 충전 -&gt; 포인트 업데이트</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserPoint</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userPointRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>myPoint</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ChargeResponse</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=수정-이후-객체지향적>수정 이후 (객체지향적)<a hidden class=anchor aria-hidden=true href=#수정-이후-객체지향적>#</a></h3><ul><li><ol><li>포인트 에게 &lsquo;충전&rsquo; 역할을 부여하기</li></ol></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span><span class=lnt id=hl-1-18><a class=lnlinks href=#hl-1-18>18</a>
</span><span class=lnt id=hl-1-19><a class=lnlinks href=#hl-1-19>19</a>
</span><span class=lnt id=hl-1-20><a class=lnlinks href=#hl-1-20>20</a>
</span><span class=lnt id=hl-1-21><a class=lnlinks href=#hl-1-21>21</a>
</span><span class=lnt id=hl-1-22><a class=lnlinks href=#hl-1-22>22</a>
</span><span class=lnt id=hl-1-23><a class=lnlinks href=#hl-1-23>23</a>
</span><span class=lnt id=hl-1-24><a class=lnlinks href=#hl-1-24>24</a>
</span><span class=lnt id=hl-1-25><a class=lnlinks href=#hl-1-25>25</a>
</span><span class=lnt id=hl-1-26><a class=lnlinks href=#hl-1-26>26</a>
</span><span class=lnt id=hl-1-27><a class=lnlinks href=#hl-1-27>27</a>
</span><span class=lnt id=hl-1-28><a class=lnlinks href=#hl-1-28>28</a>
</span><span class=lnt id=hl-1-29><a class=lnlinks href=#hl-1-29>29</a>
</span><span class=lnt id=hl-1-30><a class=lnlinks href=#hl-1-30>30</a>
</span><span class=lnt id=hl-1-31><a class=lnlinks href=#hl-1-31>31</a>
</span><span class=lnt id=hl-1-32><a class=lnlinks href=#hl-1-32>32</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>record</span> <span class=nc>UserPoint</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>point</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>updateMillis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>UserPoint</span><span class=w> </span><span class=nf>empty</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UserPoint</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>     * UserPoint 정책
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * - MIN_CHARGE_POINT_AMOUNT: 최소 포인트 충전금액
</span></span></span><span class=line><span class=cl><span class=cm>     * - MAX_CHARGE_POINT_AMOUNT: 최대 포인트 충전금액
</span></span></span><span class=line><span class=cl><span class=cm>     *
</span></span></span><span class=line><span class=cl><span class=cm>     * - MIN_USE_POINT_AMOUNT: 최소 포인트 사용금액
</span></span></span><span class=line><span class=cl><span class=cm>     * - MAX_USE_POINT_AMOUNT: 최대 포인트 사용금액
</span></span></span><span class=line><span class=cl><span class=cm>     */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>MIN_CHARGE_POINT_AMOUNT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>MAX_CHARGE_POINT_AMOUNT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>50000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>MIN_USE_POINT_AMOUNT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>MAX_USE_POINT_AMOUNT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>50000</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 포인트 충전에 대한 정책</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserPoint</span><span class=w> </span><span class=nf>charge</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>amount</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>point</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>point</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>amount</span><span class=p>;</span><span class=w> </span><span class=c1>// 포인트 충전</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UserPoint</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>point</span><span class=p>,</span><span class=w> </span><span class=n>updateMillis</span><span class=p>);</span><span class=w> </span><span class=c1>// 충전된 값으로 신규 인스턴스를 리턴</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>UserPoint가 클래스라면 set으로 데이터를 변경하여 수정할 수 있습니다.
하지만 record 클래스는 데이터를 읽을 수 있지만, 데이터변경을 금지하기 때문에 set 이 허용하지 않기때문에 포인트충전된 값으로 포인트 객체를 생성하여 리턴하였습니다.</p><ul><li><ol start=2><li>포인트 충전 로직 개선하기</li></ol></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span><span class=lnt id=hl-2-15><a class=lnlinks href=#hl-2-15>15</a>
</span><span class=lnt id=hl-2-16><a class=lnlinks href=#hl-2-16>16</a>
</span><span class=lnt id=hl-2-17><a class=lnlinks href=#hl-2-17>17</a>
</span><span class=lnt id=hl-2-18><a class=lnlinks href=#hl-2-18>18</a>
</span><span class=lnt id=hl-2-19><a class=lnlinks href=#hl-2-19>19</a>
</span><span class=lnt id=hl-2-20><a class=lnlinks href=#hl-2-20>20</a>
</span><span class=lnt id=hl-2-21><a class=lnlinks href=#hl-2-21>21</a>
</span><span class=lnt id=hl-2-22><a class=lnlinks href=#hl-2-22>22</a>
</span><span class=lnt id=hl-2-23><a class=lnlinks href=#hl-2-23>23</a>
</span><span class=lnt id=hl-2-24><a class=lnlinks href=#hl-2-24>24</a>
</span><span class=lnt id=hl-2-25><a class=lnlinks href=#hl-2-25>25</a>
</span><span class=lnt id=hl-2-26><a class=lnlinks href=#hl-2-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// PointServiceImpl.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PointServiceImpl</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>PointService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>ChargeResponse</span><span class=w> </span><span class=nf>charge</span><span class=p>(</span><span class=n>ChargeRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>id</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>amount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// 보유 포인트 조회</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>UserPoint</span><span class=w> </span><span class=n>myPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userPointRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// 포인트 계산 및 충전 (객체의 책임 부여)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>myPoint</span><span class=p>.</span><span class=na>charge</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// 포인트내역에 &#39;충전&#39; 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>this</span><span class=p>.</span><span class=na>pointHistoryRepository</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>TransactionType</span><span class=p>.</span><span class=na>CHARGE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// 보유포인트 정보 수정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>UserPoint</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userPointRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>myPoint</span><span class=p>.</span><span class=na>point</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// 응답DTO로 감싸서 리턴</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>ChargeResponse</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><hr><h2 id=포인트-사용-로직-개선시키기>포인트 사용 로직 개선시키기<a hidden class=anchor aria-hidden=true href=#포인트-사용-로직-개선시키기>#</a></h2><h3 id=수정-이전-절차지향적-1>수정 이전 (절차지향적)<a hidden class=anchor aria-hidden=true href=#수정-이전-절차지향적-1>#</a></h3><ul><li><p>포인트 사용 내부로직 플로우</p><blockquote><ol><li><code>보유 포인트 조회(db)</code></li><li><code>보유포인트와 사용포인트 비교</code></li><li><code>포인트 내역 기록(db)</code></li><li>보유포인트- 사용포인트 계산</li><li><code>보유포인트 업데이트(db)</code></li></ol><ul><li>(db) 는 의존성인 래포지토리의 메서드를 이용</li></ul></blockquote></li><li><p>문제점 분석</p></li><li><p><code>this.userPointRepository.save(id, myPoint - amount)</code> : &lsquo;사용&rsquo; 메서드안에 포인트사용 이 포함되어있습니다.</p></li><li><p>UserPoint 와 관련된 역할이 객체인 UserPoint가 책임을 지지않고 PointService의 use()함수가 책임을 지고 있습니다.</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// PointServiceImpl.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PointServiceImpl</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>PointService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=kd>public</span><span class=w> </span><span class=n>UseResponse</span><span class=w> </span><span class=nf>use</span><span class=p>(</span><span class=n>UseRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>id</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>amount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>UserPoint</span><span class=w> </span><span class=n>userPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userPointRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>myPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>userPoint</span><span class=p>.</span><span class=na>point</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// 잔고가 사용금액보다 부족할 경우</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>if</span><span class=p>(</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>myPoint</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomBusinessException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=p>.</span><span class=na>OVER_USE_AMOUNT_VALUE_THAN_BALANCE_POLICY</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// 포인트내역에 &#39;사용&#39; 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>this</span><span class=p>.</span><span class=na>pointHistoryRepository</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>TransactionType</span><span class=p>.</span><span class=na>USE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// 포인트 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>UserPoint</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userPointRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>myPoint</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>return</span><span class=w> </span><span class=n>UseResponse</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=수정-이후-객체지향적-1>수정 이후 (객체지향적)<a hidden class=anchor aria-hidden=true href=#수정-이후-객체지향적-1>#</a></h3><ul><li><p>어떻게 개선할건가?</p><blockquote><ol><li><code>보유 포인트 조회(db)</code></li><li>((객체의 책임)) <code>보유포인트와 사용포인트 비교</code> -> 보유포인트 - 사용포인트 계산 후 신규포인트를 리턴</li><li><code>포인트 내역 기록(db)</code></li><li><code>보유 포인트 업데이트(db)</code></li></ol><ul><li>(db) 는 의존성인 래포지토리의 메서드를 이용</li></ul></blockquote></li><li><ol><li>UserPoint</li></ol></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1> 1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2> 2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3> 3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4> 4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5> 5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6> 6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7> 7</a>
</span><span class=lnt id=hl-4-8><a class=lnlinks href=#hl-4-8> 8</a>
</span><span class=lnt id=hl-4-9><a class=lnlinks href=#hl-4-9> 9</a>
</span><span class=lnt id=hl-4-10><a class=lnlinks href=#hl-4-10>10</a>
</span><span class=lnt id=hl-4-11><a class=lnlinks href=#hl-4-11>11</a>
</span><span class=lnt id=hl-4-12><a class=lnlinks href=#hl-4-12>12</a>
</span><span class=lnt id=hl-4-13><a class=lnlinks href=#hl-4-13>13</a>
</span><span class=lnt id=hl-4-14><a class=lnlinks href=#hl-4-14>14</a>
</span><span class=lnt id=hl-4-15><a class=lnlinks href=#hl-4-15>15</a>
</span><span class=lnt id=hl-4-16><a class=lnlinks href=#hl-4-16>16</a>
</span><span class=lnt id=hl-4-17><a class=lnlinks href=#hl-4-17>17</a>
</span><span class=lnt id=hl-4-18><a class=lnlinks href=#hl-4-18>18</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>record</span> <span class=nc>UserPoint</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>point</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>updateMillis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...(</span><span class=n>생략</span><span class=p>)...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 포인트 사용에 대한 정책</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserPoint</span><span class=w> </span><span class=nf>use</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>amount</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 잔고가 사용금액보다 부족할 경우 CustomBusinessException 예외처리</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>amount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>point</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomBusinessException</span><span class=p>(</span><span class=n>ErrorCode</span><span class=p>.</span><span class=na>OVER_USE_AMOUNT_VALUE_THAN_BALANCE_POLICY</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>point</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>point</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>amount</span><span class=p>;</span><span class=w> </span><span class=c1>// 포인트 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UserPoint</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>point</span><span class=p>,</span><span class=w> </span><span class=n>updateMillis</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><ol start=2><li>UserPointServiceImpl</li></ol></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1> 1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2> 2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3> 3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4> 4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5> 5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6> 6</a>
</span><span class=lnt id=hl-5-7><a class=lnlinks href=#hl-5-7> 7</a>
</span><span class=lnt id=hl-5-8><a class=lnlinks href=#hl-5-8> 8</a>
</span><span class=lnt id=hl-5-9><a class=lnlinks href=#hl-5-9> 9</a>
</span><span class=lnt id=hl-5-10><a class=lnlinks href=#hl-5-10>10</a>
</span><span class=lnt id=hl-5-11><a class=lnlinks href=#hl-5-11>11</a>
</span><span class=lnt id=hl-5-12><a class=lnlinks href=#hl-5-12>12</a>
</span><span class=lnt id=hl-5-13><a class=lnlinks href=#hl-5-13>13</a>
</span><span class=lnt id=hl-5-14><a class=lnlinks href=#hl-5-14>14</a>
</span><span class=lnt id=hl-5-15><a class=lnlinks href=#hl-5-15>15</a>
</span><span class=lnt id=hl-5-16><a class=lnlinks href=#hl-5-16>16</a>
</span><span class=lnt id=hl-5-17><a class=lnlinks href=#hl-5-17>17</a>
</span><span class=lnt id=hl-5-18><a class=lnlinks href=#hl-5-18>18</a>
</span><span class=lnt id=hl-5-19><a class=lnlinks href=#hl-5-19>19</a>
</span><span class=lnt id=hl-5-20><a class=lnlinks href=#hl-5-20>20</a>
</span><span class=lnt id=hl-5-21><a class=lnlinks href=#hl-5-21>21</a>
</span><span class=lnt id=hl-5-22><a class=lnlinks href=#hl-5-22>22</a>
</span><span class=lnt id=hl-5-23><a class=lnlinks href=#hl-5-23>23</a>
</span><span class=lnt id=hl-5-24><a class=lnlinks href=#hl-5-24>24</a>
</span><span class=lnt id=hl-5-25><a class=lnlinks href=#hl-5-25>25</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// PointServiceImpl.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@RequiredArgsConstructor</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>PointServiceImpl</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>PointService</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UseResponse</span><span class=w> </span><span class=nf>use</span><span class=p>(</span><span class=n>UseRequest</span><span class=w> </span><span class=n>request</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>id</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>amount</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserPoint</span><span class=w> </span><span class=n>myPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userPointRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 포인트 사용</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>myPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>myPoint</span><span class=p>.</span><span class=na>use</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 포인트내역에 &#39;사용&#39; 기록</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>pointHistoryRepository</span><span class=p>.</span><span class=na>insert</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>TransactionType</span><span class=p>.</span><span class=na>USE</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// 보유 포인트 수정</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UserPoint</span><span class=w> </span><span class=n>result</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>this</span><span class=p>.</span><span class=na>userPointRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>myPoint</span><span class=p>.</span><span class=na>point</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=c1>// 응답 DTO로 감싸서 리턴</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>UseResponse</span><span class=p>.</span><span class=na>from</span><span class=p>(</span><span class=n>result</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li><ol start=3><li>테스트코드 수정</li></ol></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1> 1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2> 2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3> 3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4> 4</a>
</span><span class=lnt id=hl-6-5><a class=lnlinks href=#hl-6-5> 5</a>
</span><span class=lnt id=hl-6-6><a class=lnlinks href=#hl-6-6> 6</a>
</span><span class=lnt id=hl-6-7><a class=lnlinks href=#hl-6-7> 7</a>
</span><span class=lnt id=hl-6-8><a class=lnlinks href=#hl-6-8> 8</a>
</span><span class=lnt id=hl-6-9><a class=lnlinks href=#hl-6-9> 9</a>
</span><span class=lnt id=hl-6-10><a class=lnlinks href=#hl-6-10>10</a>
</span><span class=lnt id=hl-6-11><a class=lnlinks href=#hl-6-11>11</a>
</span><span class=lnt id=hl-6-12><a class=lnlinks href=#hl-6-12>12</a>
</span><span class=lnt id=hl-6-13><a class=lnlinks href=#hl-6-13>13</a>
</span><span class=lnt id=hl-6-14><a class=lnlinks href=#hl-6-14>14</a>
</span><span class=lnt id=hl-6-15><a class=lnlinks href=#hl-6-15>15</a>
</span><span class=lnt id=hl-6-16><a class=lnlinks href=#hl-6-16>16</a>
</span><span class=lnt id=hl-6-17><a class=lnlinks href=#hl-6-17>17</a>
</span><span class=lnt id=hl-6-18><a class=lnlinks href=#hl-6-18>18</a>
</span><span class=lnt id=hl-6-19><a class=lnlinks href=#hl-6-19>19</a>
</span><span class=lnt id=hl-6-20><a class=lnlinks href=#hl-6-20>20</a>
</span><span class=lnt id=hl-6-21><a class=lnlinks href=#hl-6-21>21</a>
</span><span class=lnt id=hl-6-22><a class=lnlinks href=#hl-6-22>22</a>
</span><span class=lnt id=hl-6-23><a class=lnlinks href=#hl-6-23>23</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>보유포인트_10000원에_5000원_충전하면_잔액은_15000원이된다</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// given</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>1L</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>initialPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>10000L</span><span class=p>;</span><span class=w> </span><span class=c1>// 초기 보유 잔액</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>amount</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>5000L</span><span class=p>;</span><span class=w> </span><span class=c1>// 충전금액</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>UserPoint</span><span class=w> </span><span class=n>myPoint</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>UserPoint</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>initialPoint</span><span class=p>,</span><span class=w> </span><span class=n>100L</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kt>long</span><span class=w> </span><span class=n>pointAfterCharged</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>myPoint</span><span class=p>.</span><span class=na>charge</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span><span class=w> </span><span class=c1>// 객체에게 책임을 부여</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>when</span><span class=p>(</span><span class=n>userPointRepository</span><span class=p>.</span><span class=na>findById</span><span class=p>(</span><span class=n>id</span><span class=p>)).</span><span class=na>thenReturn</span><span class=p>(</span><span class=n>myPoint</span><span class=p>);</span><span class=w> </span><span class=c1>// 충전전 보유잔액</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>when</span><span class=p>(</span><span class=n>userPointRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>pointAfterCharged</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>.</span><span class=na>thenReturn</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>UserPoint</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>pointAfterCharged</span><span class=p>,</span><span class=w> </span><span class=n>myPoint</span><span class=p>.</span><span class=na>updateMillis</span><span class=p>()));</span><span class=w> </span><span class=c1>// 충전후 보유잔액</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// when</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>ChargeResponse</span><span class=w> </span><span class=n>response</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pointService</span><span class=p>.</span><span class=na>charge</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>ChargeRequest</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>));</span><span class=w> </span><span class=c1>// 포인트 5000원 충전 수행</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// then</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>assertEquals</span><span class=p>(</span><span class=n>myPoint</span><span class=p>.</span><span class=na>charge</span><span class=p>(</span><span class=n>amount</span><span class=p>),</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=na>point</span><span class=p>());</span><span class=w> </span><span class=c1>// 충전후 예상값과 실제값 비교</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>verify</span><span class=p>(</span><span class=n>pointHistoryRepository</span><span class=p>,</span><span class=w> </span><span class=n>times</span><span class=p>(</span><span class=n>1</span><span class=p>)).</span><span class=na>insert</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>amount</span><span class=p>,</span><span class=w> </span><span class=n>TransactionType</span><span class=p>.</span><span class=na>CHARGE</span><span class=p>);</span><span class=w> </span><span class=c1>// 포인트내역 insert 호출검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=n>verify</span><span class=p>(</span><span class=n>userPointRepository</span><span class=p>,</span><span class=w> </span><span class=n>times</span><span class=p>(</span><span class=n>1</span><span class=p>)).</span><span class=na>save</span><span class=p>(</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>pointAfterCharged</span><span class=w> </span><span class=p>);</span><span class=w>  </span><span class=c1>// save(포인트정보 수정) 호출검증</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=결론-및-내-생각>결론 및 내 생각<a hidden class=anchor aria-hidden=true href=#결론-및-내-생각>#</a></h2><p>객체지향적이라는 것은 마치 객체가 살아움직이는 것처럼 능동적으로 자기역할에 대해서 책임을 지는 것을 의미한다고 생각합니다.</p><p>그러므로 객체에 대한 역할을 객체에게 부여시키는 연습을 해봤고, 이를 통해 코드라인이 줄어들었음을 확인할 수 있게되었습니다.</p><p>객체에게 역할을 부여하고 그 역할에 대한 책임을 지게끔하는게 객체지향이면서 도메인주도개발(DDD)이 아닌가 싶습니다.</p><p>코드가 변경되면 테스트코드도 같이 변경되어야합니다.
그래서 코드도 리팩터링할때도 코드의 변화가 있다면 테스트코드도 알맞게 변경해야됩니다.</p><p>코드를 예쁘게 짤려고하다보면 계속 고민을 하게되는거 같습니다.
처음에는 잘 안보이다가도 다른팀원들과 의논을 나누게되면 코드를 변경하게되는데&mldr;</p><p>요즘든 생각은 DTO클래스내부에서 직접 유효성검사를 하기보다는 비즈니스 정책과 관련되어있는 (예를들어 UserPoint 클래스의 <code>id값은 양수여야한다</code>, <code>amount값은 최소금액은 XX원 이상이어야한다</code> 등에 대한) 유효성검사 검증은 UserPoint객체에서 책임함수를 따로 만들어야할까? 라는 생각이 듭니다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a class=lnlinks href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a class=lnlinks href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a class=lnlinks href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a class=lnlinks href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a class=lnlinks href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a class=lnlinks href=#hl-7-10>10</a>
</span><span class=lnt id=hl-7-11><a class=lnlinks href=#hl-7-11>11</a>
</span><span class=lnt id=hl-7-12><a class=lnlinks href=#hl-7-12>12</a>
</span><span class=lnt id=hl-7-13><a class=lnlinks href=#hl-7-13>13</a>
</span><span class=lnt id=hl-7-14><a class=lnlinks href=#hl-7-14>14</a>
</span><span class=lnt id=hl-7-15><a class=lnlinks href=#hl-7-15>15</a>
</span><span class=lnt id=hl-7-16><a class=lnlinks href=#hl-7-16>16</a>
</span><span class=lnt id=hl-7-17><a class=lnlinks href=#hl-7-17>17</a>
</span><span class=lnt id=hl-7-18><a class=lnlinks href=#hl-7-18>18</a>
</span><span class=lnt id=hl-7-19><a class=lnlinks href=#hl-7-19>19</a>
</span><span class=lnt id=hl-7-20><a class=lnlinks href=#hl-7-20>20</a>
</span><span class=lnt id=hl-7-21><a class=lnlinks href=#hl-7-21>21</a>
</span><span class=lnt id=hl-7-22><a class=lnlinks href=#hl-7-22>22</a>
</span><span class=lnt id=hl-7-23><a class=lnlinks href=#hl-7-23>23</a>
</span><span class=lnt id=hl-7-24><a class=lnlinks href=#hl-7-24>24</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>record</span> <span class=nc>UserPoint</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>point</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kt>long</span><span class=w> </span><span class=n>updateMillis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...(</span><span class=n>생략</span><span class=p>)...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 유효성검사에 대한 정책</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 1. id에 대한 정책</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>validateId</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>id</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>0</span><span class=p>)</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomInvalidRequestException</span><span class=p>(</span><span class=s>&#34;id는 양수여야합니다.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 2. 충전 금액의 파라미터 인자 amount에 대한 정책</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>validateChargeAmount</span><span class=p>(</span><span class=kt>long</span><span class=w> </span><span class=n>amount</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>amouont</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomInvalidRequestException</span><span class=p>(</span><span class=s>&#34;amount는 양수여야합니다.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>amount</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>MIN_CHARGE_POINT_AMOUNT</span><span class=p>)</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomInvalidRequestException</span><span class=p>(</span><span class=s>&#34;amount는 최소 1000원 이상이어야 합니다.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>if</span><span class=p>(</span><span class=n>amount</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>MAX_CHARGE_POINT_AMOUNT</span><span class=p>)</span><span class=w> </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CustomInvalidRequestException</span><span class=p>(</span><span class=s>&#34;amount 최댓값은 50000원 입니다.&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>첫번째로는 비즈니스 정책만큼 가장중요한게 엔티티 객체입니다.
중요한 엔티티에게 관련 비즈니스 정책을 부여해주는 거죠.</p><p>두번째로는 이러한 책임의 부여는 변경할 가능성이 높고, 심지어 정책이 사라질 수 있는 변경에 대비할 수 있습니다.</p><p>정책과 관련된 책임을 엔티티에게 주게되면, 즉 객체지향적으로 코드를 작성하게되면 절차지향적으로 했을 때 코드로 했을 때보다 불필요한 코드를 줄일 수 있다는걸 경험했습니다.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://loveAlakazam.github.io/blog/docs/multi-thread-locks/><span class=title>« Prev</span><br><span>synchronized 와 ReentrantLock 은 어떤 차이점이 있을까?</span>
</a><a class=next href=https://loveAlakazam.github.io/blog/docs/concurrency-methods/><span class=title>Next »</span><br><span>동시성 제어 (Concurrency Methods)</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://loveAlakazam.github.io/blog/>EK Dev Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>